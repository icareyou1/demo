<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fentric.mapper.IotOnlineMapper">
    <select id="queryGatewayAndDevicesStatusByGatewayId" resultType="com.fentric.pojo.IotOnline">
        SELECT device_id,any_value(lost) lost
        FROM
            (SELECT
                a.device_id,b.lost
            FROM iot_device a
            LEFT JOIN iot_online b
            ON a.device_id=b.device_id
            WHERE
                <![CDATA[
                  (a.device_id >= #{gatewayId} AND a.device_id <= #{gatewayId}+32)
                ]]>
            ORDER BY online_id DESC LIMIT 0,1000) temp
        GROUP BY device_id
    </select>
</mapper>
